<!-- index.html -->
<!DOCTYPE html>
<html lang="my">
  <head>
    <meta charset="utf-8" />
    <title>ဝင်ငွေခွန်</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
  </head>
  <body>
    <main>
      <div class="container" id="content">
        <div class="col s12">
          <div class="card-panel">
            <h4>ဝင်ငွေခွန်</h4>
            <hr>
            <div class="card-content">
              <form class="col s12" id="incomeTaxForm" action="/">
                <div class="row">
                  <div class="col s12">
                    <input id="monthlyIncome" name="monthlyIncome" type="number" min="10000" step="10000" value="၁၀၀၀၀">
                    <label for="monthlyIncome">
                      တစ်လဝင်ငွေ
                      <!-- <span class="right" id="monthlyIncomeInText"></span> -->
                    </label>
                  </div>
                </div>
                <div class="row">
                  <div class="col s6">
                    <p>
                      <input type="checkbox" id="father" name="father" />
                      <label for="father">အတူနေ အဘ</label>
                    </p>
                    <p>
                      <input type="checkbox" id="mother" name="mother" checked="checked" />
                      <label for="mother">အတူနေ အမိ</label>
                    </p>
                  </div>
                  <div class="col s6">
                    <p>အိမ်ထောင်</p>
                    <div class="switch">
                      <label>
                        မရှိ
                        <input type="checkbox" id="married" name="married">
                        <span class="lever"></span>
                        ရှိ
                      </label>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col s12">
                    <input id="child" name="child" type="number" min="0" max="20" value="၀">
                    <label for="child">သားသမီး
                      <a href="http://www.irdmyanmar.gov.mm/ird/PDF/income%20tax%20rule2_39_58_AMeng.pdf"> (ဥပဒေ အညွှန်း -> ၃။ ခ)</a>
                    </label>
                  </div>
                  <br>
                  <br>
                  <div class="col s12">
                    <button class="btn waves-effect waves-light" type="submit">တွက်ပါ</button>
                  </div>
                </div>
              </form>
              <div id="result-body" class="result-body col s12">
                <h6>တစ်နှစ်စာအတွက် သင်ပေးဆောင်ရမည့် အခွန်ငွေ</h6>
                <h5>
                  <span id="result"></span> <small>ကျပ်</small>
                </h5>
                <p>
                  အခွန်ငွေတွက်ချက်ပုံ <a href="http://www.irdmyanmar.gov.mm/ird/PDF/Union%20Taxation%20Law1_48_44_AMmm.pdf">အညွှန်း အခန်း ၆၊ ၁၉(က)</a> 
                </p>
                <div class="row">
                  <div class="col s12">
                    <button id="back" class="btn waves-effect waves-light" type="button">နောက်သို့</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer class="page-footer">
      <div class="footer-copyright">
        <div class="container">
        Design by kny.co
        <a class="grey-text text-lighten-4 right" href="#!">Get it on github</a>
        </div>
      </div>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
    <script type="text/javascript">
      $incomeTaxForm = $("#incomeTaxForm");
      $monthlyIncome = $("#monthlyIncome");
      $father = $("#father");
      $mother = $("#mother");
      $married = $("#married");
      $child = $("#child");

      $result = $("#result");
      $resultBody = $("#result-body");
      $back = $("#back");

      function addComma(num) {
        var txt = "";
        // console.log(num.split("").forEach());
        num.split("").reverse().forEach(function (v,i) {
          if (i !== 0 && i%3 === 0)
            txt = v + "," + txt;
          else
            txt = v + txt;
        });
        return txt;
      }

      function toMyNumber(num) {
        return Array.prototype.map.call(num + "", function (n) {
          return "၀၁၂၃၄၅၆၇၈၉"[n];
        }).join("");
      }

      var discountRules = {
        parent: function (val) { return val - 1000000 },
        married: function (val) { return val - 1000000 },
        child: function (val, childAmount) { return val - (childAmount * 500000) }
      };

      function enableDisableChildOption() {
        if (!$married.is(":checked"))
          $child.prop("disabled", true);
        else
          $child.prop("disabled", false);
      }

      function init() {
        enableDisableChildOption();
      }

      $back.click(function () {
        $resultBody.removeClass("visable");
      });

      function caculate() {
        var total = $monthlyIncome.val() * 12;
        var tax;

        if ($father.is(":checked"))
          total = discountRules.parent(total);

        if ($mother.is(":checked"))
          total = discountRules.parent(total);

        if ($married.is(":checked"))
          total = discountRules.married(total);

        if ($married.is(":checked") && $child.val() > 0)
          total = discountRules.child(total, $child.val());

        // Tax Rules
        if (total <= 2000000)
          tax = 0;
        else if (total <= 5000000)
          tax = (total/100) * 5;
        else if (total <= 10000000)
          tax = (total/100) * 10;
        else if (total <= 20000000)
          tax = (total/100) * 15;
        else if (total <= 30000000)
          tax = (total/100) * 20;
        else if (total > 30000000)
          tax = (total/100) * 25;

        $resultBody.addClass("visable");
        $result.html(addComma(toMyNumber(tax)));
      }

      $married.change(enableDisableChildOption);
      $incomeTaxForm.submit(function (event) {
        event.preventDefault();
        caculate();
        return false;
      });
      init();
    </script>
  </body>
</html>
